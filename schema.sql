;             
CREATE USER IF NOT EXISTS SA SALT 'ead97c28c2e0be5b' HASH '9e31142aec73dea0546c27f3e669b7e5fc4e95f9d48a3492eb76977065eb22e0' ADMIN;           
CREATE SEQUENCE PUBLIC.GLOBAL_SEQ START WITH 100027;          
CREATE CACHED TABLE PUBLIC.DISHES(
    ID INTEGER DEFAULT (NEXT VALUE FOR PUBLIC.GLOBAL_SEQ) NOT NULL,
    NAME VARCHAR(255) NOT NULL,
    PRICE INTEGER NOT NULL,
    MENU_ID INTEGER DEFAULT (NEXT VALUE FOR PUBLIC.GLOBAL_SEQ) NOT NULL
);            
ALTER TABLE PUBLIC.DISHES ADD CONSTRAINT PUBLIC.CONSTRAINT_7 PRIMARY KEY(ID); 
-- 13 +/- SELECT COUNT(*) FROM PUBLIC.DISHES; 
INSERT INTO PUBLIC.DISHES(ID, NAME, PRICE, MENU_ID) VALUES
(100010, 'Soup', 30, 100005),
(100011, 'Potato', 60, 100005),
(100012, 'Meat', 90, 100005),
(100013, 'Soup', 50, 100006),
(100014, 'Potato', 70, 100006),
(100015, 'Meat', 120, 100006),
(100016, 'Potato', 60, 100007),
(100017, 'Meat', 130, 100007),
(100018, 'Soup', 30, 100008),
(100019, 'Fish', 98, 100008),
(100020, 'Soup', 30, 100009),
(100021, 'Vegetables', 60, 100009),
(100022, 'Fish', 150, 100009);  
CREATE CACHED TABLE PUBLIC.MENU(
    ID INTEGER DEFAULT (NEXT VALUE FOR PUBLIC.GLOBAL_SEQ) NOT NULL,
    DATE_TIME TIMESTAMP NOT NULL,
    RESTAURANT_ID INTEGER DEFAULT (NEXT VALUE FOR PUBLIC.GLOBAL_SEQ) NOT NULL
);   
ALTER TABLE PUBLIC.MENU ADD CONSTRAINT PUBLIC.CONSTRAINT_2 PRIMARY KEY(ID);   
-- 5 +/- SELECT COUNT(*) FROM PUBLIC.MENU;    
INSERT INTO PUBLIC.MENU(ID, DATE_TIME, RESTAURANT_ID) VALUES
(100005, TIMESTAMP '2017-06-10 10:10:00.0', 100003),
(100006, TIMESTAMP '2017-06-10 10:00:00.0', 100004),
(100007, TIMESTAMP '2017-06-10 09:00:00.0', 100002),
(100008, TIMESTAMP '2017-06-09 10:20:00.0', 100003),
(100009, TIMESTAMP '2017-06-09 10:00:00.0', 100004);    
CREATE CACHED TABLE PUBLIC.RESTAURANTS(
    ID INTEGER DEFAULT (NEXT VALUE FOR PUBLIC.GLOBAL_SEQ) NOT NULL,
    NAME VARCHAR(255) NOT NULL
);              
ALTER TABLE PUBLIC.RESTAURANTS ADD CONSTRAINT PUBLIC.CONSTRAINT_B PRIMARY KEY(ID);            
-- 3 +/- SELECT COUNT(*) FROM PUBLIC.RESTAURANTS;             
INSERT INTO PUBLIC.RESTAURANTS(ID, NAME) VALUES
(100002, 'restaurant1'),
(100003, 'restaurant2'),
(100004, 'restaurant3'); 
CREATE CACHED TABLE PUBLIC.USER_ROLES(
    USER_ID INTEGER DEFAULT (NEXT VALUE FOR PUBLIC.GLOBAL_SEQ) NOT NULL,
    ROLE VARCHAR(255)
);   
-- 3 +/- SELECT COUNT(*) FROM PUBLIC.USER_ROLES;              
INSERT INTO PUBLIC.USER_ROLES(USER_ID, ROLE) VALUES
(100000, 'ROLE_USER'),
(100001, 'ROLE_ADMIN'),
(100001, 'ROLE_USER');  
CREATE CACHED TABLE PUBLIC.USERS(
    ID INTEGER DEFAULT (NEXT VALUE FOR PUBLIC.GLOBAL_SEQ) NOT NULL,
    EMAIL VARCHAR(255) NOT NULL,
    PASSWORD VARCHAR(255) NOT NULL
);              
ALTER TABLE PUBLIC.USERS ADD CONSTRAINT PUBLIC.CONSTRAINT_4 PRIMARY KEY(ID);  
-- 2 +/- SELECT COUNT(*) FROM PUBLIC.USERS;   
INSERT INTO PUBLIC.USERS(ID, EMAIL, PASSWORD) VALUES
(100000, 'user@yandex.ru', '12345'),
(100001, 'admin@gmail.com', '12345');             
CREATE CACHED TABLE PUBLIC.VOTES(
    ID INTEGER DEFAULT (NEXT VALUE FOR PUBLIC.GLOBAL_SEQ) NOT NULL,
    DATE_TIME TIMESTAMP NOT NULL,
    RESTAURANT_ID INTEGER DEFAULT (NEXT VALUE FOR PUBLIC.GLOBAL_SEQ) NOT NULL,
    USER_ID INTEGER DEFAULT (NEXT VALUE FOR PUBLIC.GLOBAL_SEQ) NOT NULL
);        
ALTER TABLE PUBLIC.VOTES ADD CONSTRAINT PUBLIC.CONSTRAINT_4E PRIMARY KEY(ID); 
-- 4 +/- SELECT COUNT(*) FROM PUBLIC.VOTES;   
INSERT INTO PUBLIC.VOTES(ID, DATE_TIME, RESTAURANT_ID, USER_ID) VALUES
(100023, TIMESTAMP '2017-06-10 10:00:00.0', 100002, 100001),
(100024, TIMESTAMP '2017-06-10 09:00:00.0', 100002, 100000),
(100025, TIMESTAMP '2017-06-09 10:00:00.0', 100003, 100000),
(100026, TIMESTAMP '2017-06-09 10:45:00.0', 100004, 100001);
ALTER TABLE PUBLIC.USERS ADD CONSTRAINT PUBLIC.UK_6DOTKOTT2KJSP8VW4D0M25FB7 UNIQUE(EMAIL);    
ALTER TABLE PUBLIC.DISHES ADD CONSTRAINT PUBLIC.FKMJYXIAVMSMHLX7P6XG46A1LKF FOREIGN KEY(MENU_ID) REFERENCES PUBLIC.MENU(ID) NOCHECK;          
ALTER TABLE PUBLIC.USER_ROLES ADD CONSTRAINT PUBLIC.FKHFH9DX7W3UBF1CO1VDEV94G3F FOREIGN KEY(USER_ID) REFERENCES PUBLIC.USERS(ID) NOCHECK;     
ALTER TABLE PUBLIC.VOTES ADD CONSTRAINT PUBLIC.FKLI4UJ3IC2VYPF5PIALCHJ925E FOREIGN KEY(USER_ID) REFERENCES PUBLIC.USERS(ID) ON DELETE CASCADE NOCHECK;        
ALTER TABLE PUBLIC.MENU ADD CONSTRAINT PUBLIC.FKRR0FFV1553RCDBWSR7VCCKIPF FOREIGN KEY(RESTAURANT_ID) REFERENCES PUBLIC.RESTAURANTS(ID) ON DELETE CASCADE NOCHECK;             
ALTER TABLE PUBLIC.VOTES ADD CONSTRAINT PUBLIC.FK93NQD6KKY7CYVBE4Q1EUP9GCX FOREIGN KEY(RESTAURANT_ID) REFERENCES PUBLIC.RESTAURANTS(ID) ON DELETE CASCADE NOCHECK;            
